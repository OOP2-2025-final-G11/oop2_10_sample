<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>å›³æ›¸é¤¨ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='base-style.css') }}"
    />
    <style>
      .chart-container {
        width: 70%;
        margin: 0 auto;
      }
    </style>
  </head>
  <body>
    <h1>å›³æ›¸é¤¨ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>

    <div class="form-container">
      <h2>ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆåˆ©ç”¨è€…ï¼‰</h2>
      <div class="button-group">
        <a class="button" href="{{ url_for('user.add') }}">æ–°è¦ç™»éŒ²</a>
        <a class="button" href="{{ url_for('user.list') }}">åˆ©ç”¨è€…ä¸€è¦§</a>
      </div>

      <h2>æœ¬</h2>
      <div class="button-group">
        <a class="button" href="{{ url_for('books.add') }}">æ–°è¦ç™»éŒ²</a>
        <a class="button" href="{{ url_for('books.list') }}">æœ¬ä¸€è¦§</a>
      </div>

      <h2>æœ¬ã®è²¸å‡º</h2>
      <div class="button-group">
        <a class="button" href="{{ url_for('rental.add') }}">è²¸å‡º</a>
        <a class="button" href="{{ url_for('rental.list') }}">è²¸å‡ºä¸€è¦§</a>
      </div>

      <h2>æœ¬ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</h2>
      <div class="button-group">
        <a class="button" href="{{ url_for('book_request.add') }}"
          >æ–°è¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</a
        >
        <a class="button" href="{{ url_for('book_request.list') }}"
          >ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¸€è¦§</a
        >
      </div>
    </div>

    <h2>æœˆã”ã¨ã®è²¸å‡ºæ•°</h2>
    <p id="chart-year" class="chart-year"></p>
    <canvas id="monthlyRentalChart" width="600" height="300"></canvas>

    <h2>ğŸ“Š è²¸å‡ºãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
    <canvas id="rentalChart"></canvas>
    
    <h2>å›³æ›¸é¤¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ•°ã®æ¨ç§»ï¼ˆ{{ year }}å¹´ï¼‰</h2>
    <div class="chart-container">
      <canvas id="userChart" width="600" height="300"></canvas>
    </div>

    <script>
      fetch("/rentals/api/monthly_rentals")
        .then((res) => res.json())
        .then((result) => {
          document.getElementById("chart-year").textContent =
            result.year + "å¹´";
          const ctx = document.getElementById("monthlyRentalChart");

          new Chart(ctx, {
            type: "bar",
            data: {
              labels: result.labels,
              datasets: [
                {
                  label: "è²¸å‡ºæ•°",
                  data: result.data,
                },
              ],
            },
            options: {
              responsive: true,
              scales: {
                y: {
                  beginAtZero: true,
                },
              },
            },
          });
        });
    </script>
    <script>
      fetch("/api/rental-ranking")
        .then((res) => res.json())
        .then((json) => {
          const ctx = document.getElementById("rentalChart");

          // é †ä½ï¼‹æœ¬ã‚¿ã‚¤ãƒˆãƒ«ã‚’ xè»¸ã«è¡¨ç¤º
          const xLabels = json.labels.map((title, i) => `${i + 1}ä½\n${title}`);

          new Chart(ctx, {
            type: "bar",
            data: {
              labels: xLabels,
              datasets: [
                {
                  label: "è²¸å‡ºå›æ•°",
                  data: json.data,
                },
              ],
            },
            options: {
              plugins: {
                legend: {
                  display: false,
                },
              },
              scales: {
                x: {
                  ticks: {
                    autoSkip: false, // â† å…¨éƒ¨è¡¨ç¤ºï¼ˆé‡è¦ï¼‰
                  },
                  title: {
                    display: true,
                    text: "é †ä½ï¼ˆæœ¬ã®ã‚¿ã‚¤ãƒˆãƒ«ï¼‰",
                  },
                },
                y: {
                  beginAtZero: true,
                  title: {
                    display: true,
                    text: "è²¸å‡ºå›æ•°",
                  },
                },
              },
            },
          });
        });
    </script>
    <script>
    const userLabels = {{ labels | tojson | safe }};
    const userCounts = {{ counts | tojson | safe }};

    const ctxUser = document.getElementById("userChart");
    new Chart(ctxUser, {
      type: "line",
      data: {
        labels: userLabels,
        datasets: [{
          label: "ç´¯è¨ˆç™»éŒ²è€…æ•°ï¼ˆäººï¼‰",
          data: userCounts,
          borderColor: 'rgba(75, 192, 192, 1)',
          backgroundColor: 'rgba(75, 192, 192, 0.2)',
          fill: true,
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              precision: 0,
              stepSize: 1
            },
            title: {
              display: true,
              text: 'ç´¯è¨ˆç™»éŒ²è€…æ•°ï¼ˆäººï¼‰'
            }
          },
          x: {
            title: {
              display: true,
              text: 'å¹´æœˆ'
            }
          }
        }
      }
    });
  </script>
  </body>
</html>
